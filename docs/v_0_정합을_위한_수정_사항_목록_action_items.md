# v0 정합을 위한 수정 사항 목록 (Action Items)

> 목적: 현재 레포를 **v0 명세(텍스트 캐논, 앵커 불변, Δ 보정)**에 정확히 맞추기 위한 **수정 과제 목록**. 아래 항목들은 “왜(명세 근거) → 현재 상태 → 완료 기준(수용 조건) → 선행 조건/주의점” 순으로 정리함.
> 진행 방식: 항목 ID를 지정해 물어보면, 해당 항목만 세부 수정 방법을 단계별로 제공.

---

## A. Canon & Encoder

**A1. 공통 의미 앵커 추가**  
- **왜**: 텍스트 캐논의 하위언어공간(subspace) 구축의 기준 벡터셋이 필요(명세 1.2, 3.1).  
- **현재**: `configs/anchors/common_meanings.yml` 부재.  
- **완료**: 의미 앵커 4–6개 이상 정의, 임베딩 캐시 생성됨(`artifacts/text_anchors/*`).  
- **선행/주의**: 인코더 단일화(A3) 후 진행.

**A2. 캐논 서브스페이스(npz) 생성/적용**  
- **왜**: “사람의 하위 언어 공간”으로 투영(명세 2.A, ① 캐논 제작).  
- **현재**: `artifacts/subspace/canon_subspace.npz` 부재, 코드 훅은 존재.  
- **완료**: npz 생성 및 자동 로드 확인(`TUC_USE_SUBSPACE=1`), 투영 전/후 차이 로그.  
- **선행/주의**: A1 완료, “앵커/입력 동일 인코더” 유지.

**A3. 인코더 단일화/고정**  
- **왜**: 공간 혼용 금지(명세 8).  
- **현재**: 기본 E5 사용, 혼용 가능성 열려 있음.  
- **완료**: 환경변수/설정으로 단일 인코더 강제, 혼용 시 에러/경고.  
- **선행/주의**: CI 체크(테스트 항목 T2).

**A4. L2 정규화/온도 보정 파이프 고정**  
- **왜**: 유사도 안정화와 과신 방지(명세 4).  
- **현재**: L2는 적용, 온도 T 보정 없음.  
- **완료**: 단일 T 파라미터 적용 가능, 끄기/켜기 스위치 및 로그.

---

## B. Anchors(내용·스키마)

**B1. 행동 앵커에서 의미어 제거**  
- **왜**: 입력/규칙/앵커에서 의미 단어 금지(명세 3.2, 8).  
- **현재**: 일부 프롬프트에 의미어(위협/방어/탐색 등) 포함.  
- **완료**: 모두 표층 사실(소리 횟수, 지속, 포즈 등)로 치환.

**B2. 앵커 이름/참조 정합성 검사**  
- **왜**: 규칙↔앵커 1:1 매칭 필수(명세 5, 체크리스트).  
- **현재**: 일부 불일치 가능성, 자동 검사 없음.  
- **완료**: 린터/검사 스크립트 도입, CI에서 불일치 실패 처리.

**B3. 앵커 캐시 재생성 & 버전 태그**  
- **왜**: reproducibility(명세 1, 6).  
- **현재**: 캐시 산출물 포맷 혼재.  
- **완료**: `encoder@sha`, `anchors@vX`가 메타에 기록.

---

## C. Rules(v0) — Δ 보정 경로로 통일

**C1. 규칙 스키마 v0로 확정**  
- **왜**: `positive_pairs / tie_groups / separate_groups` 해석을 Δ로만(명세 1.3, 2.A.5).  
- **현재**: 벡터 워핑(앵커 이동) 로직 존재.  
- **완료**: v0 규칙만 사용, 워핑은 비활성(또는 실험 경로로 분리).

**C2. 규칙 텍스트에서 의미어 제거**  
- **왜**: 표층 표현만 허용(명세 3.2, 8).  
- **현재**: 의미어 다수.  
- **완료**: 전량 치환, 금지어 리스트 테스트 통과.

**C3. 종 게이트 확정**  
- **왜**: `species`별 규칙 격리(명세 5.4).  
- **현재**: 파일은 종별이나 로더에서 강제 보장은 약함.  
- **완료**: 입력 `species` 미일치 시 규칙 미적용 + 경고 로그.

---

## D. Scoring & Decision(핵심 구현)

**D1. v0 스코어러 구현/채택**  
- **왜**: `score = α·sim + γ·Δ`(명세 1.4, 4).  
- **현재**: 코사인 단독 또는 벡터 워핑 경로.  
- **완료**: v0 스코어러 모듈/CLI 제공, 단위 테스트 포함.

**D2. `abstain` 정책 적용**  
- **왜**: 오픈셋 보류(명세 2.A.7, 8).  
- **현재**: 임계 미적용/약함.  
- **완료**: `τ`로 보류, 로그/메트릭에 보류율 표시.

**D3. tie/separate 제약 적용**  
- **왜**: 동류 묶음/강제 분리(명세 1.3, 2.A.6).  
- **현재**: 미흡.  
- **완료**: 동률 묶음 처리, 상호 억제(inhibit) 옵션.

**D4. Output JSON 계약 통합**  
- **왜**: 인터페이스 안정화/설명 가능성(명세 2.A.8, 6).  
- **현재**: 출력 포맷 상이.  
- **완료**: 스펙 예시와 동일 필드/키, `reason_log` 포함.

---

## E. CLI/진입점 정리

**E1. 순환 호출 제거**  
- **왜**: `tuc cli build` ↔ 내부 스크립트 상호호출 루프(실행 막힘).  
- **현재**: 순환 경로 존재.  
- **완료**: 모든 서브커맨드는 **직접 함수 호출**, 재귀/서브프로세스 제거.

**E2. 엔트리 정규화**  
- **왜**: 실행 흐름 단선화(명세 9).  
- **현재**: `src/cli/*`와 `tuc/cli.py` 이원화.  
- **완료**: 단일 엔트리(예: `tuc build|score|eval`)로 통일.

**E3. 레거시/실험 경로 격리**  
- **왜**: v0와 v1 혼선 방지.  
- **현재**: 폴더 섞여 있음.  
- **완료**: `experimental/v1_vector_warp/`로 이동, 기본 빌드 제외.

---

## F. I/O 스키마 & 검증 도구

**F1. Observation JSONL 스키마 검증기**  
- **왜**: 입력 `text/meta/features/species` 형식 강제(명세 2.A.2).  
- **현재**: 자유형 텍스트.  
- **완료**: 스키마 밸리데이터 제공, 의미어 탐지/차단.

**F2. 언어태그/정규화**  
- **왜**: 다국어 텍스트 인코딩 일관성(명세 2.A.2).  
- **현재**: 혼재.  
- **완료**: `meta.locale` 강제/기본값, NFC 정규화.

---

## G. 평가 루틴/리포트

**G1. 아블레이션 3종 파이프**  
- **왜**: Anchors-only / Rules-only / Both 비교(명세 7).  
- **현재**: 단일 최근접만.  
- **완료**: 공통 데이터셋으로 3종 결과/그래프 산출.

**G2. α×γ, τ 스윕**  
- **왜**: 최적 조합 탐색(명세 7).  
- **현재**: 고정값.  
- **완료**: 그리드 스윕 + 최적 파라미터 로그/아카이브.

**G3. 리포트 산출(혼동행렬/보류율)**  
- **왜**: 품질 확인과 변경 추적(명세 7, 6).  
- **현재**: 산출 미흡.  
- **완료**: HTML/MD 리포트 자동 생성, `docs/reports/`에 버전 태깅.

---

## H. 문서화/버전관리

**H1. CANON.md 추가**  
- **왜**: 의미 축 정의·명명 규칙(명세 ①).  
- **현재**: 부재.  
- **완료**: 의미 앵커 정의/철학/금지어 명시.

**H2. SPECIES_ADAPT.md 추가**  
- **왜**: 종별 규칙 의도/경계 조건 명시(명세 5).  
- **현재**: 부재.  
- **완료**: 규칙 의도/예외/검증 샘플 수록.

**H3. README(루트) 실행 섹션 갱신**  
- **왜**: PowerShell 한 줄 명령/흐름 정합.  
- **현재**: 구/신 혼재.  
- **완료**: `build → subspace → score → eval` 단선 흐름 명시.

---

## I. 테스트/CI

**T1. 황금 I/O 세트 고정(6–8개)**  
- **왜**: 회귀 테스트·드리프트 감시(명세 7).  
- **현재**: 예시 흩어짐.  
- **완료**: `tests/golden/*.jsonl` 고정, 기대 라벨 포함.

**T2. 린터: 앵커–규칙–입력 교차검사**  
- **왜**: 이름/스키마/금지어 자동 점검.  
- **현재**: 수동 확인.  
- **완료**: CI에서 실패 처리, 리포트 링크 출력.

**T3. 재현성 체크(환경/seed)**  
- **왜**: 결과 안정성.  
- **현재**: 미고정.  
- **완료**: seed 고정, `environment.yml` 핀 버전, `pip install -e .` 검증.

---

## J. 안전장치/폴백

**J1. 서브스페이스 미존재 시 폴백/경고**  
- **왜**: 무의식적 전체공간 실행 방지.  
- **현재**: 조용한 폴백.  
- **완료**: 명시 경고 + 실행 로그에 캐논/npz 정보 출력.

**J2. 의미어 감지 실패 대비 수동 화이트리스트**  
- **왜**: 한국어/다국어 표현 다양성.  
- **현재**: 없음.  
- **완료**: 사전(deny/allow) 병행, 테스트 포함.

---

## 권장 작업 순서(의존성 고려)
1) A3 → A1 → A2 → A4  
2) B1 → B2 → B3  
3) C1 → C2 → C3  
4) D1 → D2 → D3 → D4  
5) E1 → E2 → E3  
6) F1 → F2  
7) G1 → G2 → G3  
8) H1 → H2 → H3  
9) T1 → T2 → T3  
10) J1 → J2

---

## 체크리스트(요약)
- [ ] A1 의미 앵커 추가  
- [ ] A2 서브스페이스 생성/적용  
- [ ] A3 인코더 단일화  
- [ ] A4 온도 보정 도입  
- [ ] B1 앵커 의미어 제거  
- [ ] B2 이름 정합성 린터  
- [ ] B3 캐시 & 버전 메타  
- [ ] C1 v0 규칙 확정(워핑 분리)  
- [ ] C2 규칙 의미어 제거  
- [ ] C3 종 게이트 강제  
- [ ] D1 v0 스코어러 구현  
- [ ] D2 `abstain` 도입  
- [ ] D3 tie/separate 제약  
- [ ] D4 Output JSON 계약  
- [ ] E1 순환 호출 제거  
- [ ] E2 엔트리 통일  
- [ ] E3 실험 경로 격리  
- [ ] F1 JSONL 스키마 검증기  
- [ ] F2 언어태그/정규화  
- [ ] G1 아블레이션 파이프  
- [ ] G2 α×γ, τ 스윕  
- [ ] G3 리포트 산출  
- [ ] H1 CANON.md  
- [ ] H2 SPECIES_ADAPT.md  
- [ ] H3 README 갱신  
- [ ] T1 황금 I/O 세트  
- [ ] T2 교차 린터(CI)  
- [ ] T3 재현성 체크  
- [ ] J1 서브스페이스 경고  
- [ ] J2 의미어 사전

